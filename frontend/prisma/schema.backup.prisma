// Prisma schema file for Pacific Sands Analytics
// PostgreSQL provider for production

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============= CORE BUSINESS DATA =============

model PaceReport {
  id            String   @id @default(cuid())
  reportDate    DateTime
  targetMonth   String
  roomType      String
  dayOfWeek     Int?
  dayName       String?
  occupancy     Float
  adr           Float
  revenue       Float
  roomsSold     Int
  roomsAvailable Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([reportDate, targetMonth])
  @@index([roomType])
}

model OccupancyData {
  id            String   @id @default(cuid())
  snapshotDate  DateTime
  fiscalYear    String
  date          DateTime
  dayOfWeek     String?
  roomType      String?  @default("All")
  available     Int
  sold          Int
  occupancyRate Float
  adr           Float?
  revPAR        Float?
  revenue       Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([snapshotDate, date, roomType])
  @@index([date])
  @@index([fiscalYear])
}

model RateShop {
  id            String   @id @default(cuid())
  reportDate    DateTime
  checkInDate   DateTime
  nights        Int?     @default(1)
  property      String
  roomType      String
  ourRate       Float?
  compRate      Float?
  difference    Float?
  percentDiff   Float?
  availability  String?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([reportDate, checkInDate])
  @@index([property])
}

model DataImport {
  id            String   @id @default(cuid())
  fileName      String
  filePath      String?
  fileType      String
  fileSize      Int?
  recordCount   Int
  importedAt    DateTime @default(now())
  status        String
  errors        Json?
  metadata      Json?
  processedBy   String?
  
  @@index([fileType, status])
}

model MonthlyMetrics {
  id            String   @id @default(cuid())
  month         DateTime
  fiscalYear    String
  avgOccupancy  Float
  avgAdr        Float
  totalRevenue  Float
  totalRoomsSold Int
  totalAvailable Int
  revPAR        Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([month, fiscalYear])
}

model Item {
  id   Int    @id @default(autoincrement())
  name String
}
