// Define database connection via Prisma Accelerate
datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

// Define Prisma Client generation
generator client {
  provider = "prisma-client-js"
}

// Data models for Pacific Sands Analytics
model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  email     String   @unique
  name      String?
}

model RateRecord {
  id        Int      @id @default(autoincrement())
  date      DateTime
  roomType  String   @map("room_type")
  rate      Float
  channel   String   @default("Direct")
  source    String   @default("api")
  filename  String   @default("unknown")
  metadata  Json?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("rate_records")
}

model OccupancyRecord {
  id             Int      @id @default(autoincrement())
  date           DateTime
  roomType       String   @map("room_type")
  occupancyRate  Float    @map("occupancy_rate")
  roomsSold      Int      @default(0) @map("rooms_sold")
  roomsAvailable Int      @default(0) @map("rooms_available")
  source         String   @default("api")
  filename       String   @default("unknown")
  metadata       Json?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("occupancy_records")
}

model UploadMetadata {
  id            Int      @id @default(autoincrement())
  filename      String
  dataType     DataType @relation(fields: [dataTypeId], references: [id])
  dataTypeId   Int      @map("data_type_id")
  recordsCount  Int      @map("records_count")
  source        String   @default("csv_upload")
  uploadedAt    DateTime @default(now()) @map("uploaded_at")
  fileSize      Int?     @map("file_size")
  processingTimeMs Int? @map("processing_time_ms")

  @@map("upload_metadata")
}

model DataType {
  id          Int               @id @default(autoincrement())
  name        String            @unique
  description String?
  fields      FieldDefinition[]
  uploads     UploadMetadata[]

  @@map("data_types")
}

model FieldDefinition {
  id         Int       @id @default(autoincrement())
  name       String
  header     String
  type       String
  required   Boolean   @default(false)
  dataType   DataType  @relation(fields: [dataTypeId], references: [id])
  dataTypeId Int       @map("data_type_id")

  @@map("field_definitions")
}

model Insight {
  id         Int      @id @default(autoincrement())
  text       String
  source     String   @default("system")
  confidence Float    @default(0.5)
  impact     String   @default("medium") // low, medium, high
  metadata   Json?
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("insights")
}
